# Changelog

Все значимые изменения в этом проекте документируются здесь.
Формат основан на [Keep a Changelog](https://keepachangelog.com/ru/1.0.0/).

## [5.6.2] — 2026-03-01

### Исправлено
- **Баннер обновления** не исчезал после успешной установки новой версии
- **Сравнение версий** давало ложное обнаружение обновления при разной длине (`5.6` vs `5.6.0`)
- **Краш сессии GNOME** при проверке обновлений (обращение к GTK из фонового потока)
- **UUID расширения** Rounded Window Corners Reborn (`@yilozt` → `@fxgn`)
- **Установка `gext`** на ALT p11 — теперь пробует `pip3`, затем `pip` с подсказкой ручной установки
- **Дублирование расширений** — запрет установки пользовательской копии поверх системной
- **Sudo** — убрана ненадёжная проверка через группу `wheel` (давала ложное «Активировано»)
- **Устаревший кэш** — статус настроек теперь всегда обновляется из системы при запуске
- После удаления расширения показывается подсказка о необходимости перезайти в сессию

### Добавлено
- **Поддержка pkexec**: если sudo не настроен, в диалоге входа появляется кнопка «Использовать pkexec» — привилегированные команды выполняются через polkit без пароля sudo
- **Автоматический вход**: если sudo работает без пароля (кэш сессии), диалог не показывается

### Изменено
- Кнопка «Установить» в баннере обновления скачивает архив с GitHub, запускает `install.sh` и перезапускает приложение автоматически
- Автоматическая проверка обновлений при старте убрана — теперь только через меню вручную
- **Фикс фантомных USB**: добавлены polkit-правила для `filesystem-mount-other-seat` и `encrypted-unlock-other-seat`

## [2.0.0] — 2026-02-23

## [2.1.0] — 2026-02-28

### Добавлено
- **Вкладка «Приложения»**:
  - **Поиск пакетов**: Интегрированный поиск по репозиториям p11, Sisyphus, EPM Play и Flathub с возможностью добавления найденного в список.
  - **Мульти-источники**: Поддержка нескольких вариантов установки для одного приложения (например, Flatpak, EPM, RPM).
  - **Бейджики**: Новый интерфейс выбора источника в строке приложения (вместо выпадающего списка).
  - Кнопка «Установить всё» (зеленая) с диалогом подтверждения и предупреждением о времени работы.
  - Кнопка «Вернуть стандартный список» (красная) для сброса `apps.json` к дефолтному состоянию.
  - Атомарная запись конфигурации (защита от повреждения файла при сбое).
- **Вкладка «Начало»**:
  - Опция установки **Nautilus Admin** (пункт «Открыть как администратор» в контекстном меню).
  - Функция отмены (Undo) для системных настроек (Sudo, TRIM, Journal, Nautilus, vm.dirty).
  - Возможность удаления (Uninstall) для EPM и Flathub.
  - Новый стиль переключателей раскладки клавиатуры (галочка-индикатор вместо текста).
- **Вкладка «Расширения»**:
  - Добавлено расширение **Pipewire Settings** в рекомендуемые.
  - Фильтрация дубликатов: системные расширения скрываются, если установлена пользовательская версия.
  - Улучшен механизм удаления (поиск папки по UUID в metadata.json).
  - Объединенный список: рекомендуемые расширения теперь отображаются в общем списке с кнопкой установки.
  - Новые расширения: Blur my Shell, Auto Accent Colour, Rounded Window Corners Reborn.
  - Поддержка установки расширений по ID (исправлена установка Auto Accent Colour).

### Изменено
- **Установка приложений**:
  - Автоматическое исправление ошибки `404 Not Found` (запуск `apt-get update` и повторная попытка).
  - Убрана принудительная блокировка интерфейса «Система занята» (теперь полагаемся на блокировки пакетного менеджера).
  - Исправлена ошибка удаления пакетов, когда пароль мог попасть в аргументы команды.
- Конфигурация приложений `apps.json` перенесена в `~/.config/altbooster/` и не перезаписывается при обновлении программы.
- Обновлен стандартный список приложений: добавлены альтернативные источники (EPM/RPM) для Telegram, браузеров и мультимедиа.
- Extension Manager перенесен из вкладки «Расширения» в «Приложения» (категория Утилиты).
- Улучшен UX кнопок: цветовая индикация (success/destructive), круглые иконки статусов.

### Добавлено
- Меню «⋮» с пунктами «О приложении», «Очистить лог», «Сбросить настройки»
- Диалог «О приложении» (Adw.AboutDialog) с лицензией MIT и ссылками
- Вкладка DaVinci Resolve: спойлер «Первичная настройка» (PostInstall, AMD ROCm, AAC, Fairlight)
- Поддержка AMD Radeon ROCm для DaVinci Resolve
- Задачи обслуживания: Scrub Btrfs (проверка и исправление ошибок данных)
- Автоотключение Btrfs-задач на системах с EXT4
- Добавлена установка Extension Manager (Flatpak) для управления расширениями GNOME
- Новая иконка приложения (жёлтый фон, символ Λ)

### Изменено
- Нативные иконки Adwaita вместо emoji-галочек ✅/❌
- EPM-команды переведены на `sudo -A` + SUDO_ASKPASS (устранены зависания)
- Дефрагментация теперь работает на всех Btrfs-разделах через `findmnt`
- Полный рефакторинг: нет однострочников через `;`, type hints, docstrings

### Исправлено
- Зависание при `epm update` и `epm full-upgrade`
- Многократный вызов `_epm_fin` при обновлении системы
- `UnboundLocalError` в `_build_fairlight_section`
- `AttributeError: Image has no attribute set_label` в `_post_done`
- Дефрагментация падала с `Text file busy` на системных файлах

## [1.0.0] — 2025-12-01

### Добавлено
- Первый публичный релиз
- Четыре вкладки: Настройки, Приложения, DaVinci Resolve, Обслуживание
- 23 приложения из Flathub и EPM
- Кэширование состояния в `~/.config/altbooster/state.json`
