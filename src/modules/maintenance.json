{
  "id": "maintenance",
  "title": "Обслуживание",
  "icon": "emblem-system-symbolic",
  "tasks": [
    {
      "id": "apt",
      "icon": "user-trash-symbolic",
      "label": "Очистка APT",
      "desc": "apt-get clean — удаляет кэш пакетов",
      "cmd": [
        "apt-get",
        "clean"
      ]
    },
    {
      "id": "flatpak",
      "icon": "application-x-addon-symbolic",
      "label": "Уборка Flatpak",
      "desc": "Удаляет неиспользуемые runtime-библиотеки",
      "cmd": [
        "flatpak",
        "uninstall",
        "--unused",
        "-y"
      ]
    },
    {
      "id": "journal",
      "icon": "document-open-recent-symbolic",
      "label": "Сжатие журналов",
      "desc": "journalctl --vacuum-time=14d",
      "cmd": [
        "journalctl",
        "--vacuum-time=14d"
      ]
    },
    {
      "id": "btrfs_bal",
      "icon": "drive-multidisk-symbolic",
      "label": "Баланс Btrfs",
      "desc": "btrfs balance -dusage=50 -musage=50 /",
      "cmd": [
        "btrfs",
        "balance",
        "start",
        "-dusage=50",
        "-musage=50",
        "/"
      ]
    },
    {
      "id": "btrfs_defrag",
      "icon": "emblem-synchronizing-symbolic",
      "label": "Дефрагментация",
      "desc": "Дефрагментация всех Btrfs разделов",
      "cmd": [
        "bash",
        "-c",
        "findmnt -lt btrfs -n -o TARGET | while read mp; do  echo \">>> $mp\";  btrfs filesystem defragment -r -czstd \"$mp\" 2>&1    | grep -v \"Text file busy\" || true; done"
      ]
    },
    {
      "id": "btrfs_scrub",
      "icon": "security-high-symbolic",
      "label": "Scrub Btrfs",
      "desc": "Проверка и исправление ошибок данных",
      "cmd": [
        "bash",
        "-c",
        "findmnt -lt btrfs -n -o TARGET | while read mp; do  echo \">>> Scrub $mp\";  btrfs scrub start -B \"$mp\"; done"
      ]
    },
    {
      "id": "trim",
      "icon": "media-flash-symbolic",
      "label": "SSD TRIM",
      "desc": "fstrim -av — оптимизация блоков SSD",
      "cmd": [
        "fstrim",
        "-av"
      ]
    },
    {
      "id": "fix_gdm_usb",
      "icon": "drive-removable-media-symbolic",
      "label": "Фикс фантомных USB",
      "desc": "Убирает лишние накопители из меню GDM (требует перезагрузки)",
      "check": {
        "type": "path",
        "value": "/etc/polkit-1/rules.d/49-no-usb-mount-gdm.rules"
      },
      "cmd": [
        "bash",
        "-c",
        "mkdir -p /etc/polkit-1/rules.d && echo 'polkit.addRule(function(action, subject) { if (subject.user == \"gdm\") { if (action.id == \"org.freedesktop.udisks2.filesystem-mount\" || action.id == \"org.freedesktop.udisks2.encrypted-unlock\" || action.id == \"org.freedesktop.udisks2.loop-setup\") { return polkit.Result.NO; } } });' > /etc/polkit-1/rules.d/49-no-usb-mount-gdm.rules && chmod 644 /etc/polkit-1/rules.d/49-no-usb-mount-gdm.rules"
      ]
    },
    {
      "id": "fix_gsconnect",
      "icon": "phone-symbolic",
      "label": "Фикс GSConnect",
      "desc": "Перезапуск daemon.js при входе (лечит ошибки соединения)",
      "type": "user",
      "check": {
        "type": "path",
        "value": "~/.config/autostart/kill-daemonjs.desktop"
      },
      "cmd": [
        "bash",
        "-c",
        "mkdir -p ~/.local/bin ~/.config/autostart; echo -e '#!/bin/sh\\nsleep 8\\nkillall daemon.js' > ~/.local/bin/kill-daemonjs.sh; chmod +x ~/.local/bin/kill-daemonjs.sh; echo -e '[Desktop Entry]\\nType=Application\\nName=Kill daemon.js\\nExec='\"$HOME\"'/.local/bin/kill-daemonjs.sh\\nX-GNOME-Autostart-enabled=true\\nNoDisplay=true' > ~/.config/autostart/kill-daemonjs.desktop"
      ]
    },
    {
      "id": "disable_tracker",
      "icon": "system-search-symbolic",
      "label": "Отключить поиск файлов",
      "desc": "Отключает службу индексации localsearch (экономит ресурсы)",
      "type": "user",
      "check": {
        "type": "path",
        "value": "~/.config/systemd/user/localsearch-3.service"
      },
      "cmd": [
        "bash",
        "-c",
        "systemctl --user mask localsearch-3 && systemctl --user stop localsearch-3"
      ]
    },
    {
      "id": "flatpak_home",
      "icon": "folder-symbolic",
      "label": "Выдать доступ к /home",
      "desc": "Разрешает всем Flatpak-приложениям доступ к домашней папке",
      "type": "user",
      "cmd": [
        "flatpak",
        "override",
        "--user",
        "--filesystem=home"
      ]
    }
  ]
}